<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullish Divergence Parameter Analyzer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            min-height: 100vh;
            color: #fff;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .control-panel {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .file-input-container {
            margin-bottom: 20px;
        }
        
        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(76,175,80,0.3);
        }
        
        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76,175,80,0.4);
        }
        
        input[type="file"] {
            display: none;
        }
        
        .file-name {
            margin-left: 15px;
            font-size: 14px;
            color: #a0d0ff;
        }
        
        .parameters-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .parameter-group {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .parameter-group h3 {
            margin-bottom: 10px;
            color: #a0d0ff;
            font-size: 1.1em;
        }
        
        .parameter-input {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .parameter-input label {
            font-size: 0.9em;
            color: #ddd;
        }
        
        .parameter-input input {
            width: 80px;
            padding: 5px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 5px;
            text-align: center;
        }
        
        .add-variant-btn {
            padding: 10px 20px;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .add-variant-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.4);
        }
        
        .analyze-btn {
            padding: 12px 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102,126,234,0.4);
        }
        
        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .variants-list {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .variant-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid;
        }
        
        .variant-toggle {
            margin-right: 10px;
        }
        
        .remove-variant {
            padding: 5px 10px;
            background: #ff4444;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }
        
        .chart-container {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stats-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stats-card h3 {
            color: #a0d0ff;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .stat-label {
            color: #ddd;
            font-size: 0.9em;
        }
        
        .stat-value {
            font-weight: bold;
            color: #fff;
        }
        
        .legend-item {
            display: inline-flex;
            align-items: center;
            margin-right: 20px;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2em;
            color: #a0d0ff;
        }
        
        .error {
            background: rgba(255,0,0,0.1);
            border: 1px solid rgba(255,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            color: #ff6b6b;
            margin-top: 10px;
        }
        
        .success {
            background: rgba(0,255,0,0.1);
            border: 1px solid rgba(0,255,0,0.3);
            padding: 15px;
            border-radius: 8px;
            color: #6bff6b;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Bullish Divergence Parameter Analyzer</h1>
        
        <div class="control-panel">
            <div class="file-input-container">
                <label for="fileInput" class="file-input-label">
                    üìÅ Parquet-Datei ausw√§hlen
                </label>
                <input type="file" id="fileInput" accept=".parquet">
                <span class="file-name" id="fileName">Keine Datei ausgew√§hlt</span>
            </div>
            
            <div class="parameters-section">
                <div class="parameter-group">
                    <h3>Window Parameter</h3>
                    <div class="parameter-input">
                        <label>Window Size:</label>
                        <input type="number" id="window" value="5" min="1" max="20">
                    </div>
                </div>
                
                <div class="parameter-group">
                    <h3>Toleranzen</h3>
                    <div class="parameter-input">
                        <label>Candle Tol (%):</label>
                        <input type="number" id="candleTol" value="0.1" step="0.01" min="0">
                    </div>
                    <div class="parameter-input">
                        <label>MACD Tol (%):</label>
                        <input type="number" id="macdTol" value="3.25" step="0.01" min="0">
                    </div>
                </div>
                
                <div class="parameter-group">
                    <h3>Variantenname</h3>
                    <div class="parameter-input">
                        <input type="text" id="variantName" placeholder="z.B. Standard" style="width: 100%;">
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <button class="add-variant-btn" onclick="addVariant()">‚ûï Variante hinzuf√ºgen</button>
                <button class="analyze-btn" onclick="analyzeData()" id="analyzeBtn">üöÄ Analyse starten</button>
            </div>
            
            <div class="variants-list" id="variantsList">
                <h3>Parametervarianten:</h3>
                <div id="variantsContainer"></div>
            </div>
        </div>
        
        <div id="chartContainer" style="display: none;">
            <div class="chart-container">
                <div id="mainChart" style="height: 600px;"></div>
            </div>
            
            <div class="stats-container" id="statsContainer"></div>
        </div>
        
        <div id="messageContainer"></div>
    </div>

    <script>
        // Globale Variablen
        let fileData = null;
        let variants = [];
        let variantColors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
            '#DDA0DD', '#98D8C8', '#FFB6C1', '#87CEEB', '#F0E68C'
        ];
        let chartData = null;
        let processedData = {};
        
        // Datei-Upload Handler
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = file.name;
                try {
                    // Parquet-Datei lesen
                    const arrayBuffer = await file.arrayBuffer();
                    fileData = await readParquetFile(arrayBuffer);
                    showMessage('Datei erfolgreich geladen!', 'success');
                } catch (error) {
                    showMessage('Fehler beim Laden der Datei: ' + error.message, 'error');
                }
            }
        });
        
        // Parquet-Datei lesen (Simulation - in der Praxis w√ºrde man eine Library verwenden)
        async function readParquetFile(arrayBuffer) {
            // Hier w√ºrde normalerweise eine Parquet-Library verwendet
            // F√ºr die Demo simulieren wir die Datenstruktur
            showMessage('Hinweis: Parquet-Unterst√ºtzung wird simuliert. Bitte CSV verwenden f√ºr echte Daten.', 'error');
            
            // Simulierte Daten generieren
            const days = 1000;
            const data = [];
            let basePrice = 100;
            
            for (let i = 0; i < days; i++) {
                const date = new Date(2020, 0, 1);
                date.setDate(date.getDate() + i);
                
                const change = (Math.random() - 0.5) * 4;
                basePrice = Math.max(50, basePrice + change);
                
                const high = basePrice + Math.random() * 2;
                const low = basePrice - Math.random() * 2;
                const open = low + Math.random() * (high - low);
                const close = low + Math.random() * (high - low);
                
                data.push({
                    date: date.toISOString().split('T')[0],
                    open: open,
                    high: high,
                    low: low,
                    close: close,
                    volume: Math.floor(Math.random() * 1000000) + 500000
                });
            }
            
            return data;
        }
        
        // Variante hinzuf√ºgen
        function addVariant() {
            const name = document.getElementById('variantName').value || `Variante ${variants.length + 1}`;
            const window = parseFloat(document.getElementById('window').value);
            const candleTol = parseFloat(document.getElementById('candleTol').value);
            const macdTol = parseFloat(document.getElementById('macdTol').value);
            
            const variant = {
                id: variants.length,
                name: name,
                window: window,
                candleTol: candleTol,
                macdTol: macdTol,
                color: variantColors[variants.length % variantColors.length],
                visible: true
            };
            
            variants.push(variant);
            updateVariantsList();
            
            // Input zur√ºcksetzen
            document.getElementById('variantName').value = '';
        }
        
        // Variantenliste aktualisieren
        function updateVariantsList() {
            const container = document.getElementById('variantsContainer');
            container.innerHTML = '';
            
            variants.forEach((variant, index) => {
                const item = document.createElement('div');
                item.className = 'variant-item';
                item.style.borderLeftColor = variant.color;
                
                item.innerHTML = `
                    <div>
                        <input type="checkbox" class="variant-toggle" 
                               id="toggle_${variant.id}" 
                               ${variant.visible ? 'checked' : ''}
                               onchange="toggleVariant(${variant.id})">
                        <label for="toggle_${variant.id}">
                            <strong>${variant.name}</strong> - 
                            Window: ${variant.window}, 
                            Candle: ${variant.candleTol}%, 
                            MACD: ${variant.macdTol}%
                        </label>
                    </div>
                    <button class="remove-variant" onclick="removeVariant(${index})">‚úï</button>
                `;
                
                container.appendChild(item);
            });
        }
        
        // Variante entfernen
        function removeVariant(index) {
            variants.splice(index, 1);
            updateVariantsList();
        }
        
        // Variante ein/ausblenden
        function toggleVariant(id) {
            const variant = variants.find(v => v.id === id);
            if (variant) {
                variant.visible = !variant.visible;
                updateChart();
            }
        }
        
        // RSI berechnen
        function calculateRSI(prices, period = 14) {
            const rsi = [];
            const gains = [];
            const losses = [];
            
            for (let i = 1; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                gains.push(change > 0 ? change : 0);
                losses.push(change < 0 ? -change : 0);
            }
            
            let avgGain = gains.slice(0, period).reduce((a, b) => a + b, 0) / period;
            let avgLoss = losses.slice(0, period).reduce((a, b) => a + b, 0) / period;
            
            for (let i = 0; i < period; i++) {
                rsi.push(null);
            }
            
            for (let i = period; i < prices.length; i++) {
                avgGain = (avgGain * (period - 1) + gains[i - 1]) / period;
                avgLoss = (avgLoss * (period - 1) + losses[i - 1]) / period;
                
                const rs = avgLoss === 0 ? 100 : avgGain / avgLoss;
                rsi.push(100 - (100 / (1 + rs)));
            }
            
            return rsi;
        }
        
        // MACD berechnen
        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macd = [];
            const signal = [];
            const histogram = [];
            
            for (let i = 0; i < prices.length; i++) {
                if (ema12[i] !== null && ema26[i] !== null) {
                    macd.push(ema12[i] - ema26[i]);
                } else {
                    macd.push(null);
                }
            }
            
            const signalLine = calculateEMA(macd.filter(v => v !== null), 9);
            let signalIndex = 0;
            
            for (let i = 0; i < macd.length; i++) {
                if (macd[i] !== null) {
                    signal.push(signalLine[signalIndex++]);
                    if (signal[i] !== null) {
                        histogram.push(macd[i] - signal[i]);
                    } else {
                        histogram.push(null);
                    }
                } else {
                    signal.push(null);
                    histogram.push(null);
                }
            }
            
            return { macd, signal, histogram };
        }
        
        // EMA berechnen
        function calculateEMA(prices, period) {
            const ema = [];
            const multiplier = 2 / (period + 1);
            
            // Erste EMA ist SMA
            let sum = 0;
            for (let i = 0; i < period && i < prices.length; i++) {
                sum += prices[i];
                if (i < period - 1) {
                    ema.push(null);
                } else {
                    ema.push(sum / period);
                }
            }
            
            // Rest mit EMA-Formel
            for (let i = period; i < prices.length; i++) {
                ema.push((prices[i] - ema[i - 1]) * multiplier + ema[i - 1]);
            }
            
            return ema;
        }
        
        // Lokale Minima finden
        function findLocalMinima(data, window) {
            const minima = [];
            
            for (let i = window; i < data.length - window; i++) {
                let isMinimum = true;
                const current = data[i];
                
                for (let j = i - window; j <= i + window; j++) {
                    if (j !== i && data[j] <= current) {
                        isMinimum = false;
                        break;
                    }
                }
                
                if (isMinimum) {
                    minima.push(i);
                }
            }
            
            return minima;
        }
        
        // Bullish Divergence erkennen
        function detectBullishDivergence(prices, rsi, macdHist, window, candleTol, macdTol) {
            const divergences = [];
            const lows = prices.map(p => p.low);
            const localMinima = findLocalMinima(lows, window);
            
            for (let i = 1; i < localMinima.length; i++) {
                const idx1 = localMinima[i - 1];
                const idx2 = localMinima[i];
                
                const priceDiff = (lows[idx2] - lows[idx1]) / lows[idx1] * 100;
                const rsiDiff = rsi[idx2] - rsi[idx1];
                const macdDiff = macdHist[idx2] - macdHist[idx1];
                
                // Klassische Bullish Divergence: Preis macht tieferes Tief, RSI/MACD machen h√∂heres Tief
                if (priceDiff <= candleTol && rsiDiff > 0 && macdDiff > 0) {
                    divergences.push({
                        type: 'classic',
                        index1: idx1,
                        index2: idx2,
                        price1: lows[idx1],
                        price2: lows[idx2],
                        rsi1: rsi[idx1],
                        rsi2: rsi[idx2],
                        macd1: macdHist[idx1],
                        macd2: macdHist[idx2]
                    });
                }
                
                // Hidden Bullish Divergence: Preis macht h√∂heres Tief, RSI/MACD machen tieferes Tief
                if (priceDiff > 0 && rsiDiff < 0 && Math.abs(macdDiff) <= macdTol) {
                    divergences.push({
                        type: 'hidden',
                        index1: idx1,
                        index2: idx2,
                        price1: lows[idx1],
                        price2: lows[idx2],
                        rsi1: rsi[idx1],
                        rsi2: rsi[idx2],
                        macd1: macdHist[idx1],
                        macd2: macdHist[idx2]
                    });
                }
            }
            
            return divergences;
        }
        
        // Daten analysieren
        async function analyzeData() {
            if (!fileData || variants.length === 0) {
                showMessage('Bitte laden Sie eine Datei und f√ºgen Sie mindestens eine Variante hinzu!', 'error');
                return;
            }
            
            showMessage('Analyse l√§uft...', 'loading');
            
            // Technische Indikatoren berechnen
            const closes = fileData.map(d => d.close);
            const rsi = calculateRSI(closes);
            const macdData = calculateMACD(closes);
            
            // F√ºr jede Variante Divergenzen erkennen
            processedData = {};
            variants.forEach(variant => {
                const divergences = detectBullishDivergence(
                    fileData,
                    rsi,
                    macdData.histogram,
                    variant.window,
                    variant.candleTol,
                    variant.macdTol
                );
                
                processedData[variant.id] = {
                    divergences: divergences,
                    stats: calculateStats(divergences, fileData.length)
                };
            });
            
            // Chart erstellen
            createChart(fileData, rsi, macdData);
            
            // Statistiken anzeigen
            updateStatistics();
            
            document.getElementById('chartContainer').style.display = 'block';
            document.getElementById('messageContainer').innerHTML = '';
        }
        
        // Statistiken berechnen
        function calculateStats(divergences, totalBars) {
            const classicCount = divergences.filter(d => d.type === 'classic').length;
            const hiddenCount = divergences.filter(d => d.type === 'hidden').length;
            
            return {
                total: divergences.length,
                classic: classicCount,
                hidden: hiddenCount,
                frequency: ((divergences.length / totalBars) * 100).toFixed(2) + '%',
                avgGap: divergences.length > 0 
                    ? (divergences.reduce((sum, d) => sum + (d.index2 - d.index1), 0) / divergences.length).toFixed(1)
                    : 0
            };
        }
        
        // Chart erstellen
        function createChart(data, rsi, macdData) {
            const dates = data.map(d => d.date);
            
            // Candlestick Trace
            const candlestick = {
                x: dates,
                open: data.map(d => d.open),
                high: data.map(d => d.high),
                low: data.map(d => d.low),
                close: data.map(d => d.close),
                type: 'candlestick',
                name: 'Price',
                xaxis: 'x',
                yaxis: 'y'
            };
            
            // RSI Trace
            const rsiTrace = {
                x: dates,
                y: rsi,
                type: 'scatter',
                mode: 'lines',
                name: 'RSI',
                line: { color: '#FFA500', width: 2 },
                xaxis: 'x',
                yaxis: 'y2'
            };
            
            // MACD Histogram
            const macdHistTrace = {
                x: dates,
                y: macdData.histogram,
                type: 'bar',
                name: 'MACD Histogram',
                marker: {
                    color: macdData.histogram.map(v => v > 0 ? '#26a69a' : '#ef5350')
                },
                xaxis: 'x',
                yaxis: 'y3'
            };
            
            const traces = [candlestick, rsiTrace, macdHistTrace];
            
            // Divergenz-Markierungen f√ºr jede Variante hinzuf√ºgen
            variants.forEach(variant => {
                if (!variant.visible) return;
                
                const variantData = processedData[variant.id];
                if (!variantData) return;
                
                // Classic Divergences
                const classicX = [];
                const classicY = [];
                const classicText = [];
                
                // Hidden Divergences
                const hiddenX = [];
                const hiddenY = [];
                const hiddenText = [];
                
                variantData.divergences.forEach(div => {
                    if (div.type === 'classic') {
                        classicX.push(dates[div.index2]);
                        classicY.push(data[div.index2].low);
                        classicText.push(`${variant.name}<br>Classic Bullish<br>RSI: ${div.rsi2.toFixed(2)}`);
                    } else {
                        hiddenX.push(dates[div.index2]);
                        hiddenY.push(data[div.index2].low);
                        hiddenText.push(`${variant.name}<br>Hidden Bullish<br>RSI: ${div.rsi2.toFixed(2)}`);
                    }
                });
                
                // Classic Divergence Markers
                if (classicX.length > 0) {
                    traces.push({
                        x: classicX,
                        y: classicY,
                        type: 'scatter',
                        mode: 'markers',
                        name: `${variant.name} - Classic`,
                        marker: {
                            size: 12,
                            color: variant.color,
                            symbol: 'triangle-up',
                            line: { color: 'white', width: 2 }
                        },
                        text: classicText,
                        hovertemplate: '%{text}<extra></extra>',
                        xaxis: 'x',
                        yaxis: 'y'
                    });
                }
                
                // Hidden Divergence Markers
                if (hiddenX.length > 0) {
                    traces.push({
                        x: hiddenX,
                        y: hiddenY,
                        type: 'scatter',
                        mode: 'markers',
                        name: `${variant.name} - Hidden`,
                        marker: {
                            size: 12,
                            color: variant.color,
                            symbol: 'diamond',
                            line: { color: 'white', width: 2 }
                        },
                        text: hiddenText,
                        hovertemplate: '%{text}<extra></extra>',
                        xaxis: 'x',
                        yaxis: 'y'
                    });
                }
            });
            
            const layout = {
                title: 'Bullish Divergence Analysis',
                dragmode: 'zoom',
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: 1.15,
                    x: 0,
                    bgcolor: 'rgba(255,255,255,0.1)'
                },
                xaxis: {
                    rangeslider: { visible: false },
                    domain: [0, 1],
                    anchor: 'y3'
                },
                yaxis: {
                    title: 'Price',
                    domain: [0.5, 1]
                },
                yaxis2: {
                    title: 'RSI',
                    domain: [0.25, 0.45],
                    anchor: 'x'
                },
                yaxis3: {
                    title: 'MACD Histogram',
                    domain: [0, 0.2],
                    anchor: 'x'
                },
                plot_bgcolor: '#1e1e1e',
                paper_bgcolor: '#1e1e1e',
                font: { color: '#ffffff' },
                hovermode: 'x unified'
            };
            
            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['select2d', 'lasso2d']
            };
            
            Plotly.newPlot('mainChart', traces, layout, config);
            chartData = { data, rsi, macdData };
        }
        
        // Chart aktualisieren (bei Sichtbarkeits√§nderungen)
        function updateChart() {
            if (chartData) {
                createChart(chartData.data, chartData.rsi, chartData.macdData);
            }
        }
        
        // Statistiken aktualisieren
        function updateStatistics() {
            const container = document.getElementById('statsContainer');
            container.innerHTML = '';
            
            // Vergleichstabelle erstellen
            const comparisonCard = document.createElement('div');
            comparisonCard.className = 'stats-card';
            comparisonCard.style.gridColumn = 'span 2';
            comparisonCard.innerHTML = '<h3>üìä Parametervergleich</h3>';
            
            const table = document.createElement('table');
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            
            // Header
            const header = document.createElement('tr');
            header.innerHTML = `
                <th style="text-align: left; padding: 10px; border-bottom: 2px solid rgba(255,255,255,0.2);">Variante</th>
                <th style="text-align: center; padding: 10px; border-bottom: 2px solid rgba(255,255,255,0.2);">Gesamt</th>
                <th style="text-align: center; padding: 10px; border-bottom: 2px solid rgba(255,255,255,0.2);">Classic</th>
                <th style="text-align: center; padding: 10px; border-bottom: 2px solid rgba(255,255,255,0.2);">Hidden</th>
                <th style="text-align: center; padding: 10px; border-bottom: 2px solid rgba(255,255,255,0.2);">Frequenz</th>
                <th style="text-align: center; padding: 10px; border-bottom: 2px solid rgba(255,255,255,0.2);">√ò Gap</th>
            `;
            table.appendChild(header);
            
            variants.forEach(variant => {
                const stats = processedData[variant.id].stats;
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid rgba(255,255,255,0.1)';
                row.innerHTML = `
                    <td style="padding: 10px;">
                        <span class="legend-color" style="background: ${variant.color}; width: 12px; height: 12px; display: inline-block; margin-right: 8px;"></span>
                        ${variant.name}
                    </td>
                    <td style="text-align: center; padding: 10px; font-weight: bold;">${stats.total}</td>
                    <td style="text-align: center; padding: 10px; color: #4ECDC4;">${stats.classic}</td>
                    <td style="text-align: center; padding: 10px; color: #FFB6C1;">${stats.hidden}</td>
                    <td style="text-align: center; padding: 10px;">${stats.frequency}</td>
                    <td style="text-align: center; padding: 10px;">${stats.avgGap} Bars</td>
                `;
                table.appendChild(row);
            });
            
            comparisonCard.appendChild(table);
            container.appendChild(comparisonCard);
            
            // Beste Variante ermitteln
            let bestVariant = null;
            let maxDivergences = 0;
            
            variants.forEach(variant => {
                const total = processedData[variant.id].stats.total;
                if (total > maxDivergences) {
                    maxDivergences = total;
                    bestVariant = variant;
                }
            });
            
            if (bestVariant) {
                const bestCard = document.createElement('div');
                bestCard.className = 'stats-card';
                bestCard.innerHTML = `
                    <h3>üèÜ Beste Variante</h3>
                    <div class="stat-item">
                        <span class="stat-label">Name:</span>
                        <span class="stat-value">${bestVariant.name}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Divergenzen:</span>
                        <span class="stat-value">${maxDivergences}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Window:</span>
                        <span class="stat-value">${bestVariant.window}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Candle Tol:</span>
                        <span class="stat-value">${bestVariant.candleTol}%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">MACD Tol:</span>
                        <span class="stat-value">${bestVariant.macdTol}%</span>
                    </div>
                `;
                container.appendChild(bestCard);
            }
            
            // Parametereinfluss-Analyse
            const analysisCard = document.createElement('div');
            analysisCard.className = 'stats-card';
            analysisCard.innerHTML = '<h3>üìà Parametereinfluss</h3>';
            
            // Window-Einfluss
            const windowAnalysis = analyzeParameterImpact('window');
            const candleAnalysis = analyzeParameterImpact('candleTol');
            const macdAnalysis = analyzeParameterImpact('macdTol');
            
            analysisCard.innerHTML += `
                <div class="stat-item">
                    <span class="stat-label">Window-Einfluss:</span>
                    <span class="stat-value">${windowAnalysis}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Candle Tol-Einfluss:</span>
                    <span class="stat-value">${candleAnalysis}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">MACD Tol-Einfluss:</span>
                    <span class="stat-value">${macdAnalysis}</span>
                </div>
            `;
            
            container.appendChild(analysisCard);
        }
        
        // Parameter-Einfluss analysieren
        function analyzeParameterImpact(parameter) {
            if (variants.length < 2) return 'Nicht genug Daten';
            
            const values = variants.map(v => ({
                param: v[parameter],
                total: processedData[v.id].stats.total
            }));
            
            // Korrelation berechnen
            const meanParam = values.reduce((sum, v) => sum + v.param, 0) / values.length;
            const meanTotal = values.reduce((sum, v) => sum + v.total, 0) / values.length;
            
            let numerator = 0;
            let denomParam = 0;
            let denomTotal = 0;
            
            values.forEach(v => {
                const diffParam = v.param - meanParam;
                const diffTotal = v.total - meanTotal;
                numerator += diffParam * diffTotal;
                denomParam += diffParam * diffParam;
                denomTotal += diffTotal * diffTotal;
            });
            
            if (denomParam === 0 || denomTotal === 0) return 'Keine Variation';
            
            const correlation = numerator / Math.sqrt(denomParam * denomTotal);
            
            if (correlation > 0.5) return '‚Üó Stark positiv';
            if (correlation > 0.2) return '‚Üó Positiv';
            if (correlation > -0.2) return '‚Üí Neutral';
            if (correlation > -0.5) return '‚Üò Negativ';
            return '‚Üò Stark negativ';
        }
        
        // Nachricht anzeigen
        function showMessage(message, type) {
            const container = document.getElementById('messageContainer');
            container.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        // Standardvarianten beim Laden hinzuf√ºgen
        window.onload = function() {
            // Standardvariante hinzuf√ºgen
            document.getElementById('variantName').value = 'Standard';
            document.getElementById('window').value = 5;
            document.getElementById('candleTol').value = 0.1;
            document.getElementById('macdTol').value = 3.25;
            addVariant();
            
            // Konservative Variante
            document.getElementById('variantName').value = 'Konservativ';
            document.getElementById('window').value = 7;
            document.getElementById('candleTol').value = 0.05;
            document.getElementById('macdTol').value = 2.0;
            addVariant();
            
            // Aggressive Variante
            document.getElementById('variantName').value = 'Aggressiv';
            document.getElementById('window').value = 3;
            document.getElementById('candleTol').value = 0.2;
            document.getElementById('macdTol').value = 5.0;
            addVariant();
        };
    </script>
</body>
</html>