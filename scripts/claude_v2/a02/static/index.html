<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bullish Divergence Analyzer 2.0</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.27.0/plotly.min.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>📈 Bullish Divergence Parameter Analyzer</h1>
            <div class="version">v2.0 - Modular Edition</div>
        </header>

        <!-- Status Bar -->
        <div class="status-bar">
            <span id="serverStatus" class="status-indicator">⚡ Verbindung prüfen...</span>
            <span id="dataStatus" class="status-indicator"></span>
        </div>

        <!-- File Upload Panel -->
        <div class="panel">
            <h3>📁 Daten laden</h3>
            <div class="file-controls">
                <label for="fileInput" class="file-label">
                    📂 CSV/Parquet auswählen
                </label>
                <input type="file" id="fileInput" accept=".csv,.parquet">
                <span id="fileName" class="file-name"></span>
                <button id="clearData" class="btn btn-danger" style="display:none;">
                    🗑️ Daten löschen
                </button>
            </div>
            <div id="uploadMsg"></div>
        </div>

        <!-- Parameter Panel -->
        <div class="panel">
            <h3>⚙️ Parameter & Varianten</h3>
            
            <!-- Quick Presets -->
            <div class="preset-buttons">
                <button onclick="loadPreset('standard')" class="btn btn-preset">Standard</button>
                <button onclick="loadPreset('conservative')" class="btn btn-preset">Konservativ</button>
                <button onclick="loadPreset('aggressive')" class="btn btn-preset">Aggressiv</button>
            </div>
            
            <div class="param-grid">
                <div class="param-group">
                    <h4>Window Parameter</h4>
                    <label>Window Size:</label>
                    <input type="number" id="window" value="5" min="1" max="20">
                </div>
                
                <div class="param-group">
                    <h4>Toleranzen</h4>
                    <label>Candle Tol (%):</label>
                    <input type="number" id="candleTol" value="0.1" step="0.01">
                    <label>MACD Tol (%):</label>
                    <input type="number" id="macdTol" value="3.25" step="0.01">
                </div>
                
                <div class="param-group">
                    <h4>Variantenname</h4>
                    <input type="text" id="variantName" placeholder="z.B. Standard">
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-success" onclick="addVariant()">➕ Variante hinzufügen</button>
                <button class="btn btn-primary" onclick="analyze()" id="analyzeBtn" disabled>
                    🚀 Analyse starten
                </button>
                <button class="btn btn-secondary" onclick="saveConfig()">💾 Konfig speichern</button>
                <button class="btn btn-secondary" onclick="loadConfig()">📂 Konfig laden</button>
            </div>
            
            <!-- Variants List -->
            <div class="variants-section">
                <h4>Parametervarianten:</h4>
                <div id="variants"></div>
            </div>
        </div>

        <!-- Results Panel -->
        <div class="panel" id="resultsPanel" style="display: none;">
            <h3>📊 Analyseergebnisse</h3>
            
            <!-- Legend -->
            <div class="legend-info">
                <span class="legend-item">▲ Classic Divergence (Preis vs. RSI)</span>
                <span class="legend-item">◆ Hidden Divergence (Preis vs. MACD)</span>
                <span class="legend-item">⬆️ Zusätzlich zur Basis</span>
                <span class="legend-item">🔍 Klick auf Marker für Details</span>
            </div>
            
            <!-- Export Buttons -->
            <div class="export-buttons">
                <button onclick="exportResults('json')" class="btn btn-export">📄 JSON Export</button>
                <button onclick="exportResults('csv')" class="btn btn-export">📊 CSV Export</button>
                <button onclick="toggleFullscreen()" class="btn btn-export">🔍 Vollbild</button>
            </div>
            
            <!-- Chart -->
            <div id="mainChart"></div>
            
            <!-- Statistics -->
            <div id="statsContainer" class="stats-container"></div>
        </div>

        <!-- Validation Panel -->
        <div class="panel" id="validationPanel" style="display: none;">
            <div class="validation-panel-header">
                <h3>🔍 Divergenz-Validierung</h3>
                <button onclick="closeValidation()" class="btn btn-danger">✕ Schließen</button>
            </div>
            <div id="validationContent" class="validation-content">
                <!-- Validierungsdetails werden hier eingefügt -->
            </div>
        </div>

        <!-- Messages -->
        <div id="messageContainer"></div>
    </div>

    <!-- JavaScript -->
    <script src="/static/app.js"></script>
</body>
</html>